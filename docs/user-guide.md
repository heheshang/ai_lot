# AI-LOT 用户指南

欢迎使用 AI-LOT 量化交易系统！本指南将帮助您快速上手并掌握系统的各项功能。

## 目录

- [1. 快速入门](#1-快速入门)
  - [1.1 首次登录](#11-首次登录)
  - [1.2 修改密码](#12-修改密码)
  - [1.3 界面概览](#13-界面概览)
- [2. 交易所配置](#2-交易所配置)
  - [2.1 添加交易所](#21-添加交易所)
  - [2.2 API密钥生成](#22-api密钥生成)
  - [2.3 连接测试](#23-连接测试)
  - [2.4 支持的交易所](#24-支持的交易所)
- [3. 行情查看](#3-行情查看)
  - [3.1 实时行情](#31-实时行情)
  - [3.2 K线图表](#32-k线图表)
  - [3.3 深度数据](#33-深度数据)
- [4. 策略开发](#4-策略开发)
  - [4.1 创建策略](#41-创建策略)
  - [4.2 策略编辑器](#42-策略编辑器)
  - [4.3 策略参数](#43-策略参数)
  - [4.4 策略模板](#44-策略模板)
  - [4.5 策略示例](#45-策略示例)
- [5. 回测验证](#5-回测验证)
  - [5.1 创建回测](#51-创建回测)
  - [5.2 回测配置](#52-回测配置)
  - [5.3 查看报告](#53-查看报告)
  - [5.4 性能指标说明](#54-性能指标说明)
- [6. 实盘交易](#6-实盘交易)
  - [6.1 部署策略](#61-部署策略)
  - [6.2 监控运行](#62-监控运行)
  - [6.3 手动交易](#63-手动交易)
  - [6.4 订单管理](#64-订单管理)
- [7. 风控管理](#7-风控管理)
  - [7.1 风控规则](#71-风控规则)
  - [7.2 风险监控](#72-风险监控)
  - [7.3 预警通知](#73-预警通知)
  - [7.4 紧急止损](#74-紧急止损)
- [8. 数据管理](#8-数据管理)
  - [8.1 数据备份](#81-数据备份)
  - [8.2 数据恢复](#82-数据恢复)
  - [8.3 数据导出](#83-数据导出)
- [9. 常见问题](#9-常见问题)
  - [9.1 安装问题](#91-安装问题)
  - [9.2 连接问题](#92-连接问题)
  - [9.3 策略问题](#93-策略问题)
  - [9.4 交易问题](#94-交易问题)

---

## 1. 快速入门

### 1.1 首次登录

安装并启动 AI-LOT 后，您将看到登录界面。

**默认管理员账户**：
- 用户名：`admin`
- 密码：`admin123`

> ⚠️ **安全提示**：首次登录后请立即修改默认密码！

### 1.2 修改密码

1. 登录后点击右上角头像
2. 选择「修改密码」
3. 输入当前密码和新密码
4. 点击「确认」完成修改

**密码要求**：
- 最少 8 位字符
- 建议包含字母、数字和特殊字符
- 定期更换以保证安全

### 1.3 界面概览

```
┌────────────────────────────────────────────────────────────┐
│  AI-LOGO          行情    策略    回测    交易    设置    用户▼ │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  ┌──────────┐  ┌──────────────────────────────────────┐  │
│  │          │  │                                       │  │
│  │  导航栏   │  │           主内容区域                 │  │
│  │          │  │                                       │  │
│  │          │  │                                       │  │
│  └──────────┘  └──────────────────────────────────────┘  │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**主菜单**：
- **仪表盘**：系统概览、快捷操作
- **行情**：实时行情、K线图表
- **策略**：策略管理、编辑器
- **回测**：回测配置、报告查看
- **交易**：实盘交易、订单管理
- **风控**：风险规则、预警设置
- **设置**：系统配置、用户管理

---

## 2. 交易所配置

### 2.1 添加交易所

1. 进入「交易所管理」页面
2. 点击「添加交易所」按钮
3. 填写表单：
   - **交易所名称**：自定义名称（如 "Binance主账户"）
   - **交易所类型**：选择 Binance 或 OKX
   - **API Key**：从交易所获取的API密钥
   - **API Secret**：从交易所获取的API密钥
4. 点击「测试连接」验证配置
5. 点击「保存」完成配置

### 2.2 API密钥生成

#### Binance API密钥生成

1. 登录 [Binance](https://www.binance.com)
2. 进入「API Management」
3. 点击「Create API」
4. 设置标签名称
5. **权限设置**：
   - ✅ **Enable Reading**（必需）
   - ⚠️ **Enable Spot & Margin Trading**（实盘交易需要）
   - ⚠️ **Enable Futures**（期货交易需要）
   - ❌ **Enable Withdrawals**（不建议开启）
6. 设置IP白名单（推荐）
7. 完成邮箱验证

#### OKX API密钥生成

1. 登录 [OKX](https://www.okx.com)
2. 进入「API管理」
3. 点击「创建API Key」
4. 设置API名称
5. **权限设置**：
   - ✅ **读取**（必需）
   - ⚠️ **交易**（实盘交易需要）
   - ❌ **提币**（不建议开启）
6. 设置IP白名单或绑定IP（推荐）
7. 完成验证

### 2.3 连接测试

配置完成后，点击「测试连接」验证：

- ✅ **连接成功**：API密钥有效，可以正常使用
- ❌ **连接失败**：请检查：
  - API Key 和 Secret 是否正确
  - 权限设置是否包含「读取」
  - IP白名单是否正确配置
  - 网络连接是否正常

### 2.4 支持的交易所

| 交易所 | 现货 | 合约 | 说明 |
|--------|------|------|------|
| Binance | ✅ | ✅ | 全球最大加密货币交易所 |
| OKX | ✅ | ✅ | 知名衍生品交易所 |
| Bybit | ⏳ | ⏳ | 计划中 |

---

## 3. 行情查看

### 3.1 实时行情

**行情列表**：
- 显示所有交易对实时价格
- 24小时涨跌幅
- 24小时成交量
- 实时更新

**操作**：
- 点击交易对切换K线图
- 右上角搜索框快速查找
- 点击收藏按钮添加自选

### 3.2 K线图表

**支持的周期**：
- 1m, 5m, 15m, 30m
- 1h, 4h, 6h, 12h
- 1d, 1w

**技术指标**：
- MA (移动平均): MA5, MA10, MA20, MA60
- MACD (指数平滑异同移动平均线)
- RSI (相对强弱指标)
- BOLL (布林带)

**图表操作**：
- 鼠标滚轮缩放
- 拖拽平移
- 十字光标查看详情
- 截图保存

### 3.3 深度数据

**订单簿**：
- 买盘/卖盘深度
- 实时挂单量
- 最新成交价

---

## 4. 策略开发

### 4.1 创建策略

1. 进入「策略管理」页面
2. 点击「新建策略」
3. 填写策略信息：
   - **策略名称**：唯一标识
   - **描述**：策略说明
   - **分类**：趋势/震荡/套利等
   - **标签**：便于分类管理
4. 点击「确定」进入编辑器

### 4.2 策略编辑器

**编辑器功能**：
- 语法高亮
- 代码提示
- 错误检查
- 格式化
- 撤销/重做

### 4.3 策略参数

参数化策略使策略更灵活：

```javascript
// 策略参数示例
const params = {
    fastPeriod: 12,    // 快线周期
    slowPeriod: 26,    // 慢线周期
    signalPeriod: 9,   // 信号线周期
    quantity: 0.1      // 交易数量
};
```

在编辑器右侧「参数配置」中添加参数：
- **参数名**：代码中使用的名称
- **显示名**：界面显示的名称
- **类型**：数字/字符串/布尔
- **默认值**：参数默认值
- **最小值/最大值**：数值范围

### 4.4 策略模板

系统提供常用策略模板：

| 模板 | 说明 | 适用场景 |
|------|------|----------|
| 双均线 | MACD策略 | 趋势跟踪 |
| 网格交易 | 固定间距网格 | 震荡市场 |
| 布林带 | BOLL突破 | 波动突破 |
| RSI反转 | RSI超买超卖 | 震荡反转 |

使用模板：
1. 新建策略时选择「从模板创建」
2. 选择合适模板
3. 根据需要修改参数和逻辑

### 4.5 策略示例

#### 双均线策略

```javascript
/**
 * 双均线交叉策略
 * - 短期均线上穿长期均线买入
 * - 短期均线下穿长期均线卖出
 */

// 策略初始化
function onInit(context) {
    // 初始化存储
    context.storage.set('position', 'none');
    context.storage.set('lastSignal', '');
}

// K线更新时调用
function onBar(context, kline) {
    // 获取历史数据
    const history = context.getHistory(kline.symbol, kline.timeframe, 50);

    const fastPeriod = context.parameters.fastPeriod || 12;
    const slowPeriod = context.parameters.slowPeriod || 26;
    const quantity = context.parameters.quantity || 0.1;

    // 数据不足
    if (history.length < slowPeriod) {
        return null;
    }

    // 计算移动平均
    function calculateMA(data, period) {
        let sum = 0;
        for (let i = 0; i < period; i++) {
            sum += data[i].close;
        }
        return sum / period;
    }

    const fastMA = calculateMA(history, fastPeriod);
    const slowMA = calculateMA(history, slowPeriod);

    // 金叉买入
    if (fastMA > slowMA) {
        const lastSignal = context.storage.get('lastSignal');
        if (lastSignal !== 'buy') {
            context.storage.set('position', 'long');
            context.storage.set('lastSignal', 'buy');
            return {
                symbol: kline.symbol,
                action: 'buy',
                quantity: quantity,
                price: kline.close
            };
        }
    }
    // 死叉卖出
    else if (fastMA < slowMA) {
        const lastSignal = context.storage.get('lastSignal');
        if (lastSignal !== 'sell') {
            context.storage.set('position', 'none');
            context.storage.set('lastSignal', 'sell');
            return {
                symbol: kline.symbol,
                action: 'sell',
                quantity: quantity,
                price: kline.close
            };
        }
    }

    return null;
}

// 策略停止时调用
function onStop(context) {
    context.storage.clear();
}
```

#### RSI策略

```javascript
/**
 * RSI超买超卖策略
 * - RSI < 30 买入（超卖）
 * - RSI > 70 卖出（超买）
 */

function onInit(context) {
    context.storage.set('position', 'none');
}

function onBar(context, kline) {
    const history = context.getHistory(kline.symbol, kline.timeframe, 30);
    const rsiPeriod = context.parameters.rsiPeriod || 14;
    const quantity = context.parameters.quantity || 0.1;

    if (history.length < rsiPeriod + 5) {
        return null;
    }

    // 计算RSI
    function calculateRSI(data, period) {
        let gains = 0, losses = 0;
        for (let i = 1; i <= period; i++) {
            const change = data[i].close - data[i-1].close;
            if (change > 0) gains += change;
            else losses -= change;
        }
        const avgGain = gains / period;
        const avgLoss = losses / period;
        const rs = avgGain / avgLoss;
        return 100 - (100 / (1 + rs));
    }

    const rsi = calculateRSI(history, rsiPeriod);
    const position = context.storage.get('position');

    // 超卖买入
    if (rsi < 30 && position !== 'long') {
        context.storage.set('position', 'long');
        return {
            symbol: kline.symbol,
            action: 'buy',
            quantity: quantity,
            price: kline.close
        };
    }

    // 超买卖出
    if (rsi > 70 && position === 'long') {
        context.storage.set('position', 'none');
        return {
            symbol: kline.symbol,
            action: 'sell',
            quantity: quantity,
            price: kline.close
        };
    }

    return null;
}

function onStop(context) {
    context.storage.clear();
}
```

---

## 5. 回测验证

### 5.1 创建回测

1. 进入「回测管理」页面
2. 点击「新建回测」
3. 配置回测参数（见下一节）
4. 点击「开始回测」

### 5.2 回测配置

**基本配置**：

| 配置项 | 说明 | 示例 |
|--------|------|------|
| 策略 | 选择要测试的策略 | 双均线策略 |
| 交易所 | 选择交易所 | Binance |
| 交易对 | 选择交易对 | BTC/USDT |
| K线周期 | 选择周期 | 1h |
| 开始时间 | 回测开始时间 | 2024-01-01 |
| 结束时间 | 回测结束时间 | 2024-12-31 |
| 初始资金 | 初始资金量 | 10000 USDT |

**高级配置**：

| 配置项 | 说明 | 推荐值 |
|--------|------|--------|
| 滑点 | 模拟成交滑点 | 0.05% |
| 手续费 | 交易手续费 | 0.1% |
| 最小交易量 | 最小下单量 | 根据交易所 |
| 仓位模式 | 全仓/逐仓 | 根据策略 |

### 5.3 查看报告

回测完成后展示详细报告：

**概要指标**：
- 总收益率
- 年化收益率
- 最大回撤
- 夏普比率
- 盈亏比
- 交易次数
- 胜率

**图表展示**：
- 资金曲线
- 回撤曲线
- 每月收益
- 持仓分布

**交易明细**：
- 开仓时间/价格
- 平仓时间/价格
- 收益
- 持仓时长

### 5.4 性能指标说明

| 指标 | 计算公式 | 说明 | 理想值 |
|------|----------|------|--------|
| **总收益率** | (期末资金 - 初始资金) / 初始资金 | 总体盈利能力 | > 0 |
| **年化收益率** | (1 + 总收益率)^(365/天数) - 1 | 标准化收益率 | > 20% |
| **最大回撤** | max((峰值 - 当前值) / 峰值) | 最大亏损幅度 | < 20% |
| **夏普比率** | (年化收益 - 无风险率) / 年化波动率 | 风险调整后收益 | > 1 |
| **胜率** | 盈利次数 / 总交易次数 | 交易准确性 | > 50% |
| **盈亏比** | 平均盈利 / 平均亏损 | 盈利质量 | > 1.5 |
| **交易次数** | | 交易频率 | 根据策略 |
| **平均持仓时长** | | 交易周期 | 根据策略 |

---

## 6. 实盘交易

### 6.1 部署策略

1. 进入「策略实例」页面
2. 点击「创建实例」
3. 配置实例：
   - **策略**：选择已回测的策略
   - **交易所**：选择配置的交易所
   - **交易对**：选择交易品种
   - **K线周期**：选择运行周期
   - **策略参数**：设置运行参数
4. 点击「启动」

> ⚠️ **风险提示**：实盘交易有风险，建议先回测验证，从小资金开始！

### 6.2 监控运行

**实例状态**：
- ⏸️ **已停止**：未运行
- ▶️ **运行中**：正常执行
- ⚠️ **异常**：需要关注
- 🛑 **已暂停**：手动暂停

**监控指标**：
- 当前持仓
- 总盈亏
- 今日盈亏
- 交易次数
- 运行时长

### 6.3 手动交易

**手动下单**：
1. 进入「手动交易」页面
2. 选择交易对
3. 设置交易方向（买入/卖出）
4. 设置订单类型：
   - **市价单**：立即成交
   - **限价单**：指定价格
5. 设置数量
6. 点击「下单」

### 6.4 订单管理

**订单状态**：
- ⏳ **待成交**：已提交未成交
- ✅ **已成交**：完全成交
- ❌ **已取消**：主动取消
- 🚫 **拒绝**：被交易所拒绝
- ⚠️ **部分成交**：部分成交

**订单操作**：
- 撤销：取消未成交订单
- 修改：修改订单价格/数量
- 查看详情：查看完整订单信息

---

## 7. 风控管理

### 7.1 风控规则

**支持的规则类型**：

| 规则类型 | 说明 | 配置示例 |
|----------|------|----------|
| **仓位限制** | 单币种最大仓位 | BTC ≤ 1000 USDT |
| **总仓位限制** | 所有持仓总值 | 总值 ≤ 10000 USDT |
| **止损** | 单笔最大亏损 | 亏损 ≥ 5% 平仓 |
| **止盈** | 单笔最大盈利 | 盈利 ≥ 10% 平仓 |
| **回撤控制** | 最大允许回撤 | 回撤 ≥ 15% 停止 |
| **日亏损限制** | 单日最大亏损 | 日亏 ≥ 3% 停止 |

**添加规则**：
1. 进入「风控规则」页面
2. 点击「添加规则」
3. 选择规则类型
4. 设置规则参数
5. 选择触发动作：
   - 🚫 **阻止交易**：拒绝下单
   - ⚠️ **发送警告**：仅通知
   - 🛑 **停止策略**：停止所有策略
   - 💰 **平仓止损**：平掉所有持仓
6. 点击「保存」

### 7.2 风险监控

**监控仪表盘**：
- 当前持仓总值
- 总盈亏
- 最大回撤
- 风险敞口
- 规则触发次数

**实时预警**：
- 规则触发时弹窗提示
- 记录预警日志
- 可选发送通知

### 7.3 预警通知

**通知渠道**：

| 渠道 | 配置 | 适用场景 |
|------|------|----------|
| **钉钉** | Webhook | 国内用户 |
| **企业微信** | Webhook | 国内用户 |
| **邮件** | SMTP | 正式报告 |
| **系统通知** | 本地 | 即时提醒 |

**配置钉钉通知**：
1. 在钉钉群添加机器人
2. 获取Webhook URL
3. 在AI-LOT中配置URL
4. 测试发送

**配置企业微信通知**：
1. 在企业微信群添加机器人
2. 获取Webhook URL
3. 在AI-LOT中配置URL
4. 测试发送

### 7.4 紧急止损

**一键止损**：
1. 进入「风控管理」页面
2. 点击「紧急止损」
3. 确认操作
4. 系统自动平掉所有持仓

> ⚠️ **警告**：此操作不可逆，请谨慎使用！

---

## 8. 数据管理

### 8.1 数据备份

**自动备份**：
- 系统每日自动备份数据库
- 保留最近7天备份
- 备份文件位于：`~/.ai-lot/backups/`

**手动备份**：
1. 进入「设置」页面
2. 选择「数据备份」
3. 点击「立即备份」
4. 选择备份位置
5. 等待完成

### 8.2 数据恢复

**恢复步骤**：
1. 关闭 AI-LOT 应用
2. 备份当前数据（可选）
3. 将备份文件复制到数据目录
4. 重启应用

**数据位置**：
- Windows: `C:\Users\<用户名>\AppData\Local\ai-lot`
- macOS: `~/Library/Application Support/ai-lot`
- Linux: `~/.config/ai-lot`

### 8.3 数据导出

**可导出数据**：
- 交易记录
- 策略代码
- 回测报告
- 订单历史

**导出格式**：
- CSV（交易记录）
- JSON（策略代码）
- PDF（回测报告）

---

## 9. 常见问题

### 9.1 安装问题

**Q: 应用无法启动？**

A: 请检查：
1. 是否安装了所有依赖
2. 操作系统版本是否支持
3. 杀毒软件是否拦截
4. 查看日志文件定位问题

**Q: 提示缺少 WebView？**

A: AI-LOT 依赖系统 WebView：
- Windows: 安装 Edge 或 WebView2 Runtime
- macOS: 无需安装，系统自带
- Linux: `sudo apt install webkit2gtk-4.0`

### 9.2 连接问题

**Q: 交易所连接失败？**

A: 检查：
1. API Key 和 Secret 是否正确
2. IP白名单是否添加
3. 网络连接是否正常
4. 是否使用了正确的网络（主网/测试网）

**Q: 行情延迟很高？**

A: 可能原因：
1. 网络延迟
2. 交易所服务器负载
3. 本地系统资源不足

建议：
- 使用稳定的网络环境
- 选择就近的交易所服务器
- 关闭不必要的应用

### 9.3 策略问题

**Q: 策略没有信号？**

A: 检查：
1. 策略逻辑是否正确
2. 参数设置是否合理
3. 市场是否符合策略条件
4. 查看策略日志

**Q: 策略报错停止？**

A: 常见原因：
1. 代码语法错误
2. 访问了不存在的数据
3. 除零错误
4. 参数类型错误

建议：
- 使用编辑器的错误检查
- 添加数据有效性验证
- 先回测验证再实盘

### 9.4 交易问题

**Q: 订单未成交？**

A: 可能原因：
1. 价格偏离市价太远
2. 市场流动性不足
3. 账户余额不足
4. 交易所限制

建议：
- 使用市价单确保成交
- 检查账户余额
- 查看订单状态和错误信息

**Q: 策略自动停止？**

A: 可能触发了风控规则：
1. 仓位超限
2. 止损触发
3. 回撤超限
4. 交易所连接断开

建议：
- 检查风控规则设置
- 查看系统日志
- 重新启动策略

---

## 附录

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + N` | 新建策略 |
| `Ctrl + S` | 保存策略 |
| `Ctrl + Enter` | 运行回测 |
| `Ctrl + B` | 加粗（编辑器） |
| `Ctrl + /` | 注释（编辑器） |

### 联系支持

- **GitHub Issues**: [提交问题](https://github.com/your-org/ai-lot/issues)
- **邮件**: support@ai-lot.dev
- **文档**: https://docs.ai-lot.dev

---

**祝您交易顺利！** 🚀
