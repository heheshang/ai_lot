# AI-LOT 开发任务规划

## 概述

本文档将项目拆解为可执行的开发任务，每个任务包含：
- **任务ID**：唯一标识
- **任务描述**：简要说明
- **依赖**：前置任务
- **估时**：预计工作量
- **验收标准**：完成标准

---

## 开发环境

### 前端构建工具

本项目使用 **Bun** 作为前端包管理器和构建工具，相比 npm/pnpm 具有以下优势：
- 更快的安装速度（比 npm 快 20-30 倍）
- 内置 TypeScript 支持
- 原生 ESM 支持
- 统一的工具链

### Bun 安装

```bash
# Windows (PowerShell)
powershell -c "irm bun.sh/install.ps1|iex"

# macOS/Linux
curl -fsSL https://bun.sh/install | bash

# 验证安装
bun --version
```

### 常用命令

```bash
# 安装依赖（替代 npm install）
bun install

# 添加依赖（替代 npm install <package>）
bun add <package>
bun add -d <package>  # 开发依赖

# 运行脚本（替代 npm run <script>）
bun run <script>
bun dev      # 开发服务器
bun build    # 构建生产版本

# 升级依赖
bun update
```

---

## Phase 1: 基础框架 (1-2周)

**目标**：搭建项目基础架构，实现用户认证和基础UI

### 1.1 项目初始化

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P1-01 | 更新 package.json 依赖 | - | 0.5h | Vue 3、Pinia、Element Plus、ECharts 依赖安装完成 |
| P1-02 | 创建项目目录结构 | P1-01 | 1h | src/、src-tauri/ 目录按架构文档创建 |
| P1-03 | 配置 TypeScript 类型定义 | P1-02 | 1h | src/types/ 目录创建，基础类型定义完成 |
| P1-04 | 配置 ESLint + Prettier | P1-02 | 0.5h | 代码格式化配置生效 |
| P1-05 | 配置 Tauri 基础设置 | P1-02 | 0.5h | tauri.conf.json 配置完成 |

### 1.2 数据库层

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P1-06 | 创建数据库迁移文件 | P1-02 | 2h | migrations/001_initial_schema.sql 创建完成 |
| P1-07 | 实现 sqlx 数据库连接 | P1-06 | 2h | infrastructure/database.rs 可正常连接数据库 |
| P1-08 | 实现数据模型 (models/) | P1-07 | 2h | User, Role, Exchange 等基础模型定义 |
| P1-09 | 实现 Repository Trait | P1-08 | 1h | repository/mod.rs 定义完成 |
| P1-10 | 实现 UserRepository | P1-09 | 1h | 可通过用户名查询用户 |

### 1.3 用户认证

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P1-11 | 实现密码哈希 (argon2) | P1-10 | 1h | infrastructure/crypto.rs 密码哈希/验证功能 |
| P1-12 | 实现用户登录 Tauri 命令 | P1-11 | 1h | commands/user.rs login 命令 |
| P1-13 | 实现权限检查中间件 | P1-12 | 1h | core/auth/permission.rs 权限验证 |
| P1-14 | 实现操作审计日志 | P1-13 | 1h | infrastructure/audit.rs 审计日志记录 |

### 1.4 前端基础

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P1-15 | 配置 Vue Router | P1-04 | 0.5h | 基础路由配置完成 |
| P1-16 | 配置 Pinia Store | P1-04 | 0.5h | store/ 目录和基础 store 创建 |
| P1-17 | 实现 Tauri API 封装 | P1-16 | 1h | api/tauri.ts 封装 invoke 方法 |
| P1-18 | 实现 Login 页面 | P1-17 | 2h | 登录表单、验证、调用登录接口 |
| P1-19 | 实现 Dashboard 布局 | P1-18 | 2h | 侧边栏导航、顶栏、主内容区 |
| P1-20 | 实现用户状态管理 | P1-19 | 1h | store/user.ts 用户登录状态 |

---

## Phase 2: 行情数据模块 (1-2周)

**目标**：连接交易所，实现实时行情展示

### 2.1 交易所抽象层

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P2-01 | 定义 Exchange Trait | - | 2h | core/trade/exchange/trait.rs 接口定义 |
| P2-02 | 定义数据类型 (Ticker, Kline) | P2-01 | 1h | core/trade/types.rs |
| P2-03 | 实现 Binance REST API | P2-02 | 3h | core/trade/exchange/binance.rs 基础API |
| P2-04 | 实现 Binance WebSocket | P2-03 | 3h | WebSocket 连接、行情订阅 |

### 2.2 行情数据服务

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P2-05 | 实现 EventBus | P2-04 | 2h | core/event_bus.rs 事件广播 |
| P2-06 | 实现 MarketService | P2-05 | 2h | services/market_service.rs 行情服务 |
| P2-07 | 实现行情数据缓存 | P2-06 | 1h | K线数据写入 SQLite |
| P2-08 | 实现 Tauri 行情命令 | P2-07 | 1h | commands/market.rs 命令封装 |

### 2.3 行情前端

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P2-09 | 实现 MarketStore | P2-08 | 1h | store/market.ts 状态管理 |
| P2-10 | 实现交易对列表组件 | P2-09 | 2h | SymbolList.vue |
| P2-11 | 集成 ECharts K线图 | P2-10 | 3h | KlineChart.vue 基础K线 |
| P2-12 | 实现行情实时更新 | P2-11 | 2h | WebSocket 监听和界面刷新 |
| P2-13 | 实现 MarketView 页面 | P2-12 | 1h | 行情视图页面整合 |

---

## Phase 3: 策略开发模块 (2-3周)

**目标**：实现策略编辑器和回测引擎

### 3.1 策略编辑器

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P3-01 | 集成 Monaco Editor | - | 2h | components/MonacoEditor.vue |
| P3-02 | 实现策略参数编辑表单 | P3-01 | 2h | ParameterEditor.vue |
| P3-03 | 实现 StrategyEditor 页面 | P3-02 | 2h | 代码编辑+参数配置 |
| P3-04 | 实现策略保存/加载 | P3-03 | 1h | 调用 Tauri 命令 |

### 3.2 策略引擎

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P3-05 | 实现策略脚本执行 | P3-04 | 3h | JavaScript 引擎集成 |
| P3-06 | 实现策略上下文 API | P3-05 | 2h | 策略可访问行情、下单API |
| P3-07 | 实现 StrategyEngine | P3-06 | 3h | 策略启动/停止/状态管理 |
| P3-08 | 实现策略实例管理 | P3-07 | 1h | 实例生命周期 |

### 3.3 回测引擎

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P3-09 | 实现历史数据加载 | P3-08 | 1h | 从 SQLite 加载K线 |
| P3-10 | 实现模拟交易所 | P3-09 | 2h | SimulatedExchange 订单撮合 |
| P3-11 | 实现回测引擎 | P3-10 | 3h | 逐根K线回放 |
| P3-12 | 实现性能指标计算 | P3-11 | 2h | 夏普比率、最大回撤等 |
| P3-13 | 实现回测报告生成 | P3-12 | 2h | JSON 格式报告 |

### 3.4 回测前端

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P3-14 | 实现回测配置表单 | P3-13 | 1h | BacktestConfig.vue |
| P3-15 | 实现回测进度显示 | P3-14 | 1h | 进度条、日志 |
| P3-16 | 实现回测报告页面 | P3-15 | 2h | 指标展示、图表 |
| P3-17 | 实现策略列表页面 | P3-16 | 1h | 策略CRUD操作 |

---

## Phase 4: 实盘交易模块 (2-3周)

**目标**：实现策略实盘运行和交易管理

### 4.1 订单管理

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P4-01 | 实现订单状态机 | - | 2h | Order 状态转换逻辑 |
| P4-02 | 实现持仓管理 | P4-01 | 2h | Position 计算和更新 |
| P4-03 | 实现 TradeService | P4-02 | 3h | 下单/撤单/查询封装 |
| P4-04 | 实现 Tauri 交易命令 | P4-03 | 1h | commands/trade.rs |

### 4.2 策略实盘运行

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P4-05 | 实现实盘策略循环 | P4-04 | 3h | 订阅行情→执行策略→下单 |
| P4-06 | 实现策略实例持久化 | P4-05 | 1h | 状态保存到数据库 |
| P4-07 | 实现策略启停控制 | P4-06 | 1h | 启动/停止/暂停功能 |
| P4-08 | 实现策略状态查询 | P4-07 | 0.5h | 实例状态接口 |

### 4.3 交易前端

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P4-09 | 实现 TradeStore | P4-08 | 1h | 交易状态管理 |
| P4-10 | 实现订单列表组件 | P4-09 | 1h | OrderList.vue |
| P4-11 | 实现持仓列表组件 | P4-10 | 1h | PositionList.vue |
| P4-12 | 实现手动下单表单 | P4-11 | 1h | ManualOrder.vue |
| P4-13 | 实现交易控制台页面 | P4-12 | 2h | TradeConsole.vue 整合 |

---

## Phase 5: 风控系统 (1-2周)

**目标**：实现风险监控和预警

### 5.1 风控规则引擎

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P5-01 | 定义 RiskRule Trait | - | 1h | 风控规则接口 |
| P5-02 | 实现仓位限制规则 | P5-01 | 1h | PositionLimitRule |
| P5-03 | 实现回撤限制规则 | P5-02 | 1h | DrawdownLimitRule |
| P5-04 | 实现风控监控 | P5-03 | 2h | RiskMonitor 定时检查 |

### 5.2 预警通知

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P5-05 | 实现预警记录 | P5-04 | 1h | 写入 risk_alerts 表 |
| P5-06 | 实现钉钉通知 | P5-05 | 1h | DingTalk Webhook |
| P5-07 | 实现邮件通知 | P5-06 | 1h | SMTP 邮件发送 |
| P5-08 | 实现紧急止损功能 | P5-07 | 1h | 一键平仓 |

### 5.3 风控前端

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P5-09 | 实现风控规则配置页面 | P5-08 | 2h | RiskRules.vue |
| P5-10 | 实现风险监控仪表盘 | P5-09 | 2h | RiskMonitor.vue |
| P5-11 | 实现预警历史页面 | P5-10 | 1h | RiskAlerts.vue |

---

## Phase 6: 完善与优化 (1-2周)

**目标**：系统稳定，生产可用

| ID | 任务 | 依赖 | 估时 | 验收标准 |
|----|------|------|------|----------|
| P6-01 | 错误处理统一 | - | 2h | 全局错误处理 |
| P6-02 | 日志系统完善 | P6-01 | 1h | 结构化日志 |
| P6-03 | 配置文件管理 | P6-02 | 1h | 配置读写 |
| P6-04 | 数据备份恢复 | P6-03 | 2h | 自动备份 |
| P6-05 | 性能优化 | P6-04 | 3h | 查询优化、缓存 |
| P6-06 | 单元测试 | P6-05 | 4h | 核心模块测试覆盖 |
| P6-07 | 用户文档 | P6-06 | 3h | README、使用手册 |

---

## 任务依赖图

```
Phase 1: 基础框架
├── P1-01 ~ P1-05: 项目初始化
├── P1-06 ~ P1-10: 数据库层
├── P1-11 ~ P1-14: 用户认证
└── P1-15 ~ P1-20: 前端基础

Phase 2: 行情数据 (依赖 Phase 1)
├── P2-01 ~ P2-04: 交易所抽象
├── P2-05 ~ P2-08: 行情服务
└── P2-09 ~ P2-13: 行情前端

Phase 3: 策略开发 (依赖 Phase 1, 2)
├── P3-01 ~ P3-04: 策略编辑器
├── P3-05 ~ P3-08: 策略引擎
├── P3-09 ~ P3-13: 回测引擎
└── P3-14 ~ P3-17: 回测前端

Phase 4: 实盘交易 (依赖 Phase 1, 2, 3)
├── P4-01 ~ P4-04: 订单管理
├── P4-05 ~ P4-08: 策略实盘
└── P4-09 ~ P4-13: 交易前端

Phase 5: 风控系统 (依赖 Phase 1, 4)
├── P5-01 ~ P5-04: 风控引擎
├── P5-05 ~ P5-08: 预警通知
└── P5-09 ~ P5-11: 风控前端

Phase 6: 完善优化 (依赖所有)
└── P6-01 ~ P6-07: 各项优化
```

---

## 估时汇总

| Phase | 任务数 | 总估时 | 建议工期 |
|-------|--------|--------|----------|
| Phase 1 | 20 | 16h | 1-2周 |
| Phase 2 | 13 | 19h | 1-2周 |
| Phase 3 | 17 | 27h | 2-3周 |
| Phase 4 | 13 | 18h | 2-3周 |
| Phase 5 | 11 | 14h | 1-2周 |
| Phase 6 | 7 | 16h | 1-2周 |
| **合计** | **81** | **110h** | **10-14周** |

---

## 开发建议

### 优先级规则
1. **P0**: 核心功能，必须实现
2. **P1**: 重要功能，尽快实现
3. **P2**: 增强功能，有时间再做

### 并行开发策略
- 前后端可并行开发：接口先定义契约
- 多模块可并行：按 Phase 顺序推进
- 独立功能可并行：如通知系统可单独开发

### 里程碑检查点
- **M1**: Phase 1 完成后，可登录、基础UI可用
- **M2**: Phase 2 完成后，可查看实时行情
- **M3**: Phase 3 完成后，可编写策略并回测
- **M4**: Phase 4 完成后，可实盘运行策略
- **M5**: Phase 5 完成后，完整风控体系
- **M6**: Phase 6 完成后，生产可用

### 风险点
- **WebSocket 稳定性**: 交易所断线重连处理
- **策略脚本安全**: 防止恶意代码
- **回测性能**: 大量数据处理
- **实盘风险**: 策略Bug可能导致损失

---

## 下一步

请选择要开始的 Phase，我将为第一个任务创建详细的实现方案。
